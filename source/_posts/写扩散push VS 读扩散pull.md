# 写扩散push VS 读扩散pull

IM的经典实现方式：

1. 写扩散push
2. 读扩散pull

## 1. 写扩散 push

想象每个用户拥有一个**收件箱**，发送方每次发送消息都往他人的**收件箱**写数据，而接收方接收消息只需要读自己的**收件箱**。

**优点**

1. 读操作简单

**缺点**

1. 写操作复杂

## 2. 读扩散 pull（Recommend）

想象每个用户拥有一个**发件箱**，发送方每次发送消息都往自己的**发件箱**里写数据，而接收方接收消息需要拉取所有人的**发件箱**。

**优点**

1. 写操作简单

**缺点**

1. 读操作复杂

# IM 是读多写少 or 写多读少？

这个问题需要分情况讨论：

1. 所有人都在线
2. 有人不在线

## 1. 所有人都在线

所有人都在线的情况下，理论上读写持平。

原因：无论基于push还是pull实现，不管是群聊还是私聊，每个发送者发送的消息和接收者接收的消息次数是持平的。

## 2. 有人不在线

有人不在线的情况下，理论上写多读少。

原因：给不在线的用户发消息，接收方上线后可以**批量读取（算1次）**，所以读的次数会比写的次数少。

## 结论

通常情况肯定有人不在线，所以IM是写多读少，应该使用**读扩散pull**实现。

